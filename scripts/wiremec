#!/usr/bin/env python3
from __future__ import annotations

import os
import sys


def _add_path(p: str):
    if p and p not in sys.path:
        sys.path.insert(0, p)


def _bootstrap_paths():
    # Dev mode: running from the git checkout.
    script_dir = os.path.dirname(os.path.abspath(__file__))
    dev_root = os.path.abspath(os.path.join(script_dir, ".."))
    if os.path.isdir(os.path.join(dev_root, "wireme")):
        _add_path(dev_root)

    # Installed mode: install.sh copies code to /usr/local/lib/wireme by default.
    lib_dir = os.environ.get("WIREME_LIB_DIR", "/usr/local/lib/wireme")
    if os.path.isdir(os.path.join(lib_dir, "wireme")):
        _add_path(lib_dir)


def main(argv: list[str] | None = None) -> int:
    _bootstrap_paths()
    from wireme.client_main import main as cli_main

    return int(cli_main(argv))


if __name__ == "__main__":
    raise SystemExit(main(sys.argv[1:]))
